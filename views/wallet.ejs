
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wardrobe</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Dancing+Script:wght@400;700&family=Montserrat:wght@400;700&family=Lora:wght@400;700&display=swap" rel="stylesheet">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">

  <link rel="stylesheet" href="/css/style.css">
  
</head>

<body>
  
  <%- include('partials/navbar') %>
  
  <div class="container mt-5">
    <h2>Wallet</h2>
    <p>Recharge you wallet and shop using wallet money </p>
    <p>Recharge with minimum of Rs.4000 </p>

  <div class="alert alert-danger">
    <p class="wallet-balance"><h1>Your Wallet Balance:</h1> <h1><strong>₹<span id="wallet-balance"><%= balance %></span></strong></h1></p>
  </div>
  <p><button class="add-money-btn w-20" onclick="showRechargeBox()">+ Add Money</button></p>
    
    <div class="recharge-box" id="recharge-box">
        <input type="number" id="amount" min="4000" placeholder="Enter Amount (Min ₹4000)">
        <button class="add-money-btn" onclick="startPayment()">Recharge Wallet</button>
    </div>
</div>

<!-- Wallet Recharge History -->
<div class="container">
  <div class="history">
      <h3>Wallet Transaction History</h3>
      <table class="table table-bordered">
          <thead>
              <tr>
                  <th>Date</th>
                  <th>Transaction Type</th>
                  <th>Description</th>
                  <th>Amount</th>
              </tr>
          </thead>
          <tbody>
              <% if (transactions.length > 0) { %>
                  <% transactions.forEach(transaction => { %>
                      <tr>
                          <td><%= new Date(transaction.date).toLocaleString() %></td>
                          <td><%= transaction.transactionType === "credit" ? "Credit" : "Debit" %></td>
                          <td><%= transaction.description %></td>
                          <td style="color: <%= transaction.transactionType === 'credit' ? 'green' : 'red' %>;">
                              <%= transaction.transactionType === "credit" ? "+₹" + transaction.amount : "-₹" + transaction.amount %>
                          </td>
                      </tr>
                  <% }) %>
              <% } else { %>
                  <tr>
                      <td colspan="4" class="text-center">No transactions found.</td>
                  </tr>
              <% } %>
          </tbody>
      </table>

      <!-- Pagination -->
      <nav>
          <ul class="pagination justify-content-center">
              <% if (currentPage > 1) { %>
                  <li class="page-item">
                      <a class="page-link" href="?page=<%= currentPage - 1 %>">Previous</a>
                  </li>
              <% } %>
              
              <% for (let i = 1; i <= totalPages; i++) { %>
                  <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                      <a class="page-link" href="?page=<%= i %>"><%= i %></a>
                  </li>
              <% } %>
              
              <% if (currentPage < totalPages) { %>
                  <li class="page-item">
                      <a class="page-link" href="?page=<%= currentPage + 1 %>">Next</a>
                  </li>
              <% } %>
          </ul>
      </nav>
  </div>
</div>


<!-- Razorpay Script -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
     function showRechargeBox() {
            document.getElementById("recharge-box").style.display = "block";
        }
    async function startPayment() {
        const amount = document.getElementById("amount").value;

        const response = await fetch("/wallet/create-order", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ amount }),
        });

        const data = await response.json();
        if (!data.success) return alert("Error creating order!");

        const options = {
    key: "<%= razorpayKey %>",
    amount: data.order.amount,
    currency: "INR",
    name: "Wallet Recharge",
    description: "Add money to your wallet",
    order_id: data.order.id,
    prefill: {
        name: "Test User",
        email: "test@example.com",
        contact: "9999999999"
    },
    theme: { color: "#3399cc" },
    handler: function (response) {
        fetch("/wallet/payment-success", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ order_id: data.order.id, amount }),
        }).then(() => location.reload());
    },
};

        const rzp = new Razorpay(options);
        rzp.open();
    }
</script>
